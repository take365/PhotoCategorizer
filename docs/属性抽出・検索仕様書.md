# 属性抽出・検索仕様書

## 目的

* 画像属性を **自然文 + カテゴライズ** の2段階で抽出し、検索や絞り込みに利用する。
* location / subject は情報量を増やすために自然文を長めに保持する。
* tone / style / composition / other をタグ型カテゴリとして扱い、検索の絞り込みや要約に利用する。

## 抽出方式

### ステップ1: 自然文生成

* **対象**: location, subject
* **形式**: 日本語自然文 50〜100文字程度
* **例**:

```json
"location": "都会の高層ビルが並ぶ交差点。車や人が行き交い、夕暮れの空が赤く染まり始めている。",
"subject": "スーツ姿の男性が横断歩道を歩きながらスマートフォンを見ている様子。"
```

### ステップ2: カテゴリ抽出

* **対象**: tone, style, composition, other
* **形式**: 各カテゴリごとに英語IDの配列（tone/style/composition は最大3件、other は0〜1件）
* **tone**: ライティング・色のトーン（`bright`, `dark`, `backlit`, `golden-hour`, `night`, `warm`, `cool`, `neutral`, `monochrome`, `sepia`）
* **style**: 雰囲気・質感（`cinematic`, `vintage`, `minimal`, `dramatic`）
* **composition**: 構図・視点（`close-up`, `wide`, `top-view`, `low-angle`, `centered`, `thirds`）
* **other**: 上記に当てはまらない補足タグ。実利用では空配列を基本とし、必要な場合のみ1件まで英語スラッグで記述。
* 表示時は日本語ラベルにマッピングする（例: `backlit` →「逆光」）。

**例**

```json
"tags": {
  "tone": ["warm", "bright"],
  "style": ["cinematic"],
  "composition": ["wide", "thirds"],
  "other": []
}
```

---

## 検索仕様

* **自然文検索**:

  * location / subject に対してテキスト埋め込み検索を行う。
  * 類似検索が必要な場合は自然文からのベクトル検索で対応。

* **カテゴリ検索**:

* tone / style / composition / other を対象。
* UI ではトグル式の日本語ラベルで選択。tone/style/composition は複数選択可、other は1件まで。
* 異なるカテゴリ間は AND、同カテゴリ内は OR として扱い、重み付けされた類似検索と併用する。

---

## データ構造

```json
{
  "location": "50〜100文字の自然文",
  "subject": "50〜100文字の自然文",
  "tags": {
    "tone": ["warm"],
    "style": ["cinematic"],
    "composition": ["wide"],
    "other": []
  }
}
```

---

## 運用メモ

* 抽出は必ず2段階（自然文→カテゴリ）。
* 自然文は冗長でも可、情報を落とさないことを優先。
* カテゴリは定義済みリストのみから選択し、未知のタグは `other` へ英語スラッグで格納するか破棄する。
* 画面表示では日本語ラベルを使用し、内部データは英語IDで保持する。
* 検索は **location/subject のベクトル検索 + タグフィルタ** の組み合わせ。
* 類似検索の主軸は自然文ベクトルで、タグは補助的な絞り込みと要約表示に用いる。
